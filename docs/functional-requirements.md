# 機能要件仕様書

## 1. プロジェクト概要

### 1.1 目的
友人同士のカジュアルな麻雀および定期的な麻雀サークルにおけるスコア記録・管理を効率化し、参加者全員が成績を共有できるアプリケーションを提供する。

### 1.2 主要ユーザー
- グループ管理者: グループ作成・設定・メンバー管理を行うユーザー
- メンバー: 麻雀に参加し、スコアの入力・管理および成績閲覧を行うユーザー

### 1.3 利用シーン
- 友人同士のカジュアルな麻雀の集まり
- 定期的な麻雀サークルや固定メンバーでの対局

### 1.4 技術スタック
- フロントエンド: Next.js + Tailwind CSS
- バックエンド/DB: Supabase
- 認証: Supabase Auth (Google OAuth)
- デプロイ: Vercel (想定)
- 形態: PWA（Progressive Web App）

### 1.5 デザイン方針
- シンプルで機能的
- 直感的な操作フロー
- レスポンシブデザイン（モバイルファースト）
- 初心者でも使いやすいUI/UX

## 2. 機能要件

### 2.1 認証機能

#### 2.1.1 ユーザー登録・ログイン
- **FR-AUTH-001**: Google OAuth によるログイン機能
  - Google アカウントでワンクリックログイン
  - Supabase Auth を利用
  - 初回ログイン時にユーザープロファイル自動作成

- **FR-AUTH-002**: ログアウト機能
  - ヘッダーまたは設定メニューからログアウト可能

- **FR-AUTH-003**: 認証状態の永続化
  - リロード後もログイン状態を維持
  - セッション管理

#### 2.1.2 ユーザープロファイル
- **FR-AUTH-004**: プロファイル情報
  - 表示名（Google アカウントから自動取得）
  - プロフィール画像（Google アカウントから自動取得）
  - ユーザーID（自動生成）

### 2.2 グループ管理機能

#### 2.2.1 グループ作成
- **FR-GROUP-001**: グループ新規作成
  - ログイン済みユーザーなら誰でも作成可能
  - グループ名の設定（必須）
  - 作成者が自動的にグループ管理者となる

- **FR-GROUP-002**: グループルール設定
  - 基本設定:
    - 東風戦 / 東南戦の選択
    - 開始点数（例: 25000点）
    - 返し点（例: 30000点）
    - ウマ（例: 5-10、10-20など）
    - オカの有無
  - レート設定:
    - 点棒1000点あたりのポイント
  - 拡張設定:
    - トビ賞の有無とポイント
    - 役満祝儀の有無とポイント
    - トップ賞の有無とポイント

- **FR-GROUP-003**: グループルールの表示
  - グループ詳細画面でルールを常時確認可能

#### 2.2.2 メンバー管理
- **FR-GROUP-004**: 招待リンク生成
  - グループ管理者が招待リンクを生成
  - リンクをコピーして共有可能
  - リンクにアクセスしたユーザーがグループに参加

- **FR-GROUP-005**: メンバー一覧表示
  - グループに所属するメンバーの一覧
  - 各メンバーの名前とプロフィール画像を表示


#### 2.2.3 グループ一覧
- **FR-GROUP-007**: 所属グループ一覧表示
  - ログインユーザーが所属する全グループを表示
  - グループ名、メンバー数、最終更新日時を表示
  - タップ/クリックでグループ詳細へ遷移

### 2.3 スコア記録機能

#### 2.3.1 半荘記録（MVP: シンプル入力方式）
- **FR-SCORE-001**: 新規半荘の作成
  - グループメンバーなら誰でも実行可能
  - 「新しい半荘」ボタンから開始

- **FR-SCORE-002**: 参加プレイヤー選択
  - グループメンバーから4名を選択
  - 座席（東南西北）の割り当て

- **FR-SCORE-003**: 対局設定
  - 東風戦 / 東南戦の選択（グループルールをデフォルト表示）
  - 変更可能

- **FR-SCORE-004**: 最終持ち点の入力
  - 各プレイヤーの最終持ち点を入力
  - 数値キーボードで入力しやすく

- **FR-SCORE-005**: トビ・祝儀の入力
  - トビの有無を選択（該当プレイヤーを指定）
  - 役満祝儀の有無と個数を入力

- **FR-SCORE-006**: 自動計算
  - 各プレイヤーの収支を自動計算
    - 素点計算
    - ウマ・オカの適用
    - トビ賞・祝儀の加算
    - レート適用後のポイント計算
  - 順位の自動判定

- **FR-SCORE-007**: エラーチェック
  - 合計点数の検証（4人の合計が正しいか）
  - エラーがある場合は警告を表示
  - 入力ミスの防止

- **FR-SCORE-008**: 確認と保存
  - 計算結果の確認画面
  - 保存ボタンで確定
  - 保存後は日次集計画面に遷移

#### 2.3.2 半荘記録の修正・削除
- **FR-SCORE-009**: 記録の編集
  - グループメンバーなら誰でも保存済み半荘を編集可能
  - 編集画面で各項目を修正
  - 再計算と保存

- **FR-SCORE-010**: 記録の削除
  - グループメンバーなら誰でも保存済み半荘を削除可能
  - 削除確認ダイアログを表示
  - 削除後は日次集計を再計算

### 2.4 集計・表示機能

#### 2.4.1 日次集計画面
- **FR-VIEW-001**: 日付選択
  - カレンダーまたは日付ピッカーで日付を選択
  - デフォルトは当日

- **FR-VIEW-002**: その日の半荘一覧
  - 選択した日に記録された全半荘を時系列で表示
  - 各半荘の開始時刻、参加メンバー、順位を表示

- **FR-VIEW-003**: 日次ランキング
  - その日の総合収支順にプレイヤーをランキング表示
  - 順位、プレイヤー名、総合収支、半荘数を表示

- **FR-VIEW-004**: 日次総合収支
  - 各プレイヤーのその日の全半荘の合計収支
  - ポイントとポイントの両方を表示

#### 2.4.2 半荘詳細画面
- **FR-VIEW-005**: 半荘の詳細情報表示
  - 日時
  - 東風戦/東南戦
  - 参加プレイヤーと座席
  - 各プレイヤーの最終持ち点、収支、順位
  - トビ・祝儀の有無
  - 適用されたルール

- **FR-VIEW-006**: 半荘詳細からの編集・削除
  - グループメンバーなら編集・削除ボタンを表示

#### 2.4.3 グループ成績一覧
- **FR-VIEW-007**: 全期間の成績一覧
  - グループ内の全プレイヤーの通算成績
  - プレイヤー名、対局数、総合収支を表示
  - 収支順にソート可能

- **FR-VIEW-008**: 成績のフィルタリング
  - 期間指定（今月、今週、全期間など）
  - プレイヤー絞り込み

### 2.5 画面構成

#### 2.5.1 共通要素
- **FR-UI-001**: ヘッダー
  - アプリ名/ロゴ
  - ユーザーアイコン（タップでメニュー表示）
  - 戻るボタン（必要な画面のみ）

- **FR-UI-002**: ナビゲーション
  - ホーム
  - 所属グループ一覧
  - ユーザー設定

#### 2.5.2 画面一覧
1. ログイン画面
   - Google ログインボタン

2. ホーム画面
   - 所属グループ一覧
   - 「新しいグループを作成」ボタン

3. グループ作成画面
   - グループ名入力
   - ルール設定フォーム
   - 作成ボタン

4. グループ詳細画面
   - グループ名とルール表示
   - メンバー一覧
   - 招待リンク生成ボタン
   - 「新しい半荘」ボタン
   - 日次集計へのリンク
   - 全期間成績へのリンク

5. 半荘記録画面
   - プレイヤー選択
   - 対局設定
   - 最終持ち点入力
   - トビ・祝儀入力
   - 計算結果プレビュー
   - 保存ボタン

6. 日次集計画面
   - 日付選択
   - 半荘一覧
   - ランキング表示

7. 半荘詳細画面
   - 詳細情報表示
   - 編集・削除ボタン

8. グループ成績画面
   - 全プレイヤーの通算成績
   - フィルタリング機能

9. ユーザー設定画面
   - プロフィール情報
   - ログアウトボタン

## 3. 非機能要件

### 3.1 セキュリティ
- 全通信はHTTPS で暗号化
- Supabase Row Level Security (RLS) でデータアクセス制御
- グループデータは所属メンバーのみアクセス可能

### 3.2 互換性
- モダンブラウザの最新版に対応（Chrome, Safari, Firefox, Edge）
- iOS, Android, Windows, macOS で動作

## 4. データ要件

### 4.1 主要エンティティ
- Users: ユーザー情報
- Groups: グループ情報
- GroupMembers: グループとユーザーの関連
- GroupRules: グループルール設定
- Games: 半荘記録
- GameResults: 各プレイヤーの半荘結果

### 4.2 データ保持期間
- 全データ: 無期限保持（ユーザーまたはグループ削除まで）

## 5. 用語集

| 用語 | 説明 |
|||
| 半荘 | 麻雀の1回の対局単位（東風戦または東南戦） |
| 東風戦 | 東場のみで終了する短い対局形式 |
| 東南戦 | 東場と南場で構成される標準的な対局形式 |
| ウマ | 順位に応じたボーナスポイント |
| オカ | 返し点と開始点の差分による調整 |
| トビ | 持ち点が0点未満になること |
| 祝儀 | 役満などの特定条件で発生するボーナス |
| レート | 点棒をポイントに換算する際の倍率 |
| 素点 | ウマオカ適用前の得点 |
| 返し点 | 収支計算の基準点（通常30000点または25000点） |
